{% extends 'social_distribution/base.html' %}

{% block content %}


<!-- Container for all posts -->
<div class="content">
  <h2>Your Stream</h2>
  {% for post in posts %}
  <!-- Each post in its own block with margin, border, and padding -->
  <div style="margin-bottom: 1em; border: 1px solid #ccc; padding: 1em;" class="post">
    
    <p><strong>{{ post.author.display_name }}</strong></p>

    {% if post.text %}
      <!-- If 'content_type' was text/markdown, post.text is HTML -->
      <div>{{ post.text|safe }}</div>
    {% endif %}

    {% if post.image %}
      <img src="{{ post.image.url }}" alt="Post Image" width="300">
    {% endif %}

    {% if post.video %}
      <video width="300" controls>
        <source src="{{ post.video.url }}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    {% endif %}

    {% if user.is_authenticated and author is not None %}
      <form method="post" action="{% url 'like_post' author.id post.id %}">
        {% csrf_token %}
        <input type="hidden" name="type" value="like">
        <button type="submit" class="btn btn-primary">Like: {{ post.likes.count }}</button>
      </form>
    {% endif %}

    {% if post.comments %}
      <h3>Comments</h3>
      <div class="comments">
        <ul>
          {% for comment in post.comments %}
            <li>{{ comment.author.displayName }}: {{ comment.comment }}</li>
            {% if user.is_authenticated and author is not None %}
              <form method="post" action="{% url 'like_comment' author.id comment.id %}">
                {% csrf_token %}
                <input type="hidden" name="type" value="like">
                <button type="submit" class="btn btn-primary">Like: {{ comment.likes.count }}</button>
              </form>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    {% endif %}
    
    <p>Posted on {{ post.created_at }}</p>

    <!-- Button for copying link to posts -->
    <button type="button" class="copy-post-link" data-copy="{{ request.scheme }}://{{ request.get_host }}/authors/{{ post.author.id }}/posts/{{ post.id }}/view/">
      <span class="copy-label">Copy Link</span>
    </button>

    {% if user.is_authenticated and author is not None %}
      <div class="comment-form">
        <form method="post" action="{% url 'commented' author.id %}">
          {% csrf_token %}
          <input type="hidden" name="type" value="comment">
          <textarea name="comment" rows="3" cols="50"></textarea>
          <input type="hidden" name="post" value="{{ post.id }}">
          <input type="hidden" name="contentType" value="text/plain">
          <button type="submit" class="btn btn-primary">Comment</button>
        </form>
      </div>
    {% endif %}
  </div> <!-- end single post container -->
  {% endfor %}
</div> <!-- end all-posts container -->

{% endblock %}
